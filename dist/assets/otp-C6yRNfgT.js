import{s as e}from"./supabaseClient-CvVHAHOf.js";async function m(r,s){let a=null;if(a=(await e.from("profiles").select("id, email, full_name").or(`email.eq.${r},username.eq.${r}`).maybeSingle()).data,!a&&r){const{data:i}=await e.from("accounts").select("user_id").eq("account_number",r).maybeSingle();if(i&&i.user_id){const{data:d}=await e.from("profiles").select("id, email, full_name").eq("id",i.user_id).maybeSingle();a=d}}if(!a||!a.id)throw new Error("User not found. Please use a valid email address or account number.");const{data:t}=await e.from("login_otps").select("*").eq("user_id",a.id).eq("otp",s).eq("used",!1).order("created_at",{ascending:!1}).limit(1).single();if(!t||new Date(t.expires_at)<new Date)throw new Error("Invalid or expired OTP.");await e.from("login_otps").update({used:!0}).eq("id",t.id);const{data:o,error:n}=await e.auth.signInWithPassword({email:a.email,password:t.temp_password});if(await e.from("login_otps").update({temp_password:null}).eq("id",t.id),n||!o?.session)throw new Error("Session could not be created.");return await e.auth.setSession(o.session),!0}export{m as verifyOtp};
