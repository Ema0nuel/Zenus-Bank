import{s as e}from"./supabaseClient-B1HaFb4P.js";import{s as S}from"./email-cNRN05tX.js";async function x(o){try{const t=await(await fetch(`https://ipapi.co/${o}/json/`)).json();return{city:t.city,region:t.region,country:t.country_name}}catch{return{city:"",region:"",country:""}}}async function V(o,a){const{email:t,password:w,firstname:r,lastname:n,title:f,phone:y,country_code:_,nationality:b,address:h,city:g,state:E,zip:$,dob:D,occupation:U,ssn:j,marital_status:z,gender:G,username:A,acctype:c}=o,{data:i,error:l}=await e.auth.signUp({email:t,password:w});if(l)throw new Error(l.message);if(!i?.user?.id)throw new Error("Failed to create user account");const s=i.user.id,I={id:s,full_name:`${r} ${n}`,title:f||null,firstname:r,lastname:n,phone:y||null,country_code:_||null,nationality:b||null,address:h||null,city:g||null,state:E||null,zip:$||null,dob:D||null,occupation:U||null,ssn:j||null,marital_status:z||null,gender:G||null,email:t,username:`${r} ${n}`||null},{error:u}=await e.from("profiles").insert(I);if(u)throw new Error(u.message);const d="10"+Math.floor(1e9+Math.random()*9e9),{data:M,error:m}=await e.from("accounts").insert({user_id:s,account_type:c,account_number:d,balance:0,interest_rate:c==="USD SAVING"?2.5:4}).select().single();if(m)throw new Error(m.message);const{error:p}=await e.from("crypto_balances").insert({user_id:s,account_id:M.id,btc_balance:0,eth_balance:0,usdt_balance:0,usdc_balance:0,bnb_balance:0,sol_balance:0});if(p)throw new Error(p.message);const N=await x(a);await S({name:`${r} ${n}`,email:t,accountNumber:d,ip:a,geo:N}),window.location.href="/user/auth"}export{V as s};
