import{s as e}from"./supabaseClient-B1HaFb4P.js";import{a as p}from"./email-cNRN05tX.js";import"https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";import"./sendEmail-89Z52C2k.js";async function E(a,o){let r=null,t=null,n=await e.from("profiles").select("id, email, full_name").or(`email.eq.${a},username.eq.${a}`).maybeSingle();if(r=n.data,t=n.error,(!r||t)&&a){const{data:i,error:c}=await e.from("accounts").select("user_id").eq("account_number",a).maybeSingle();if(i&&i.user_id){const{data:d,error:f}=await e.from("profiles").select("id, email, full_name").eq("id",i.user_id).maybeSingle();r=d,t=f}}if(t||!r)throw new Error("Invalid credentials.");if(!r||!r.email)throw new Error("Invalid credentials.");const{data:s,error:m}=await e.auth.signInWithPassword({email:r.email,password:o});if(m||!s?.user)throw new Error("Invalid credentials.");const l=Math.floor(1e5+Math.random()*9e5).toString(),u=new Date(Date.now()+10*60*1e3).toISOString();return await e.from("login_otps").insert({user_id:r.id,otp:l,expires_at:u,used:!1,temp_password:o}),await p({to:r.email,name:r.full_name,otp:l}),!0}export{E as loginAndSendOtp};
